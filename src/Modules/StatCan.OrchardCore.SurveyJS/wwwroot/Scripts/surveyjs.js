/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

function initSurveyJS(surveyjs) {
  var decodedJson = atob(surveyjs.dataset.data);
  var id = surveyjs.dataset.id;
  Survey.StylesManager.applyTheme("default");
  Survey.JsonObject.metaData.addProperty("itemvalue", {
    name: "score:number"
  });
  window.survey = new Survey.Model(decodedJson);
  survey.onComplete.add(function (result) {
    var plainData = result.getPlainData({
      calculations: [{
        propertyName: "score"
      }]
    });
    var totalScore = 0;

    function calcScore(data) {
      return (data || []).reduce(function (sum, item) {
        return sum + (item.isNode ? calcScore(item.data) : item.score);
      }, 0);
    }

    totalScore = calcScore(plainData);
    var score = JSON.stringify(totalScore);

    if (score != "null") {
      document.querySelector('.surveyResult').innerHTML = "Total Score is: " + score;
    }
  });
  survey.render(id + '-result');
}

document.querySelectorAll('.surveyResult').forEach(initSurveyJS);